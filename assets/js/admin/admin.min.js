!function(e){Vue.component("lego_container",{template:"#container-template",props:["cont_id","cont_data","lego_layout","parent_type","parent_id","child_type","preview_data","type","grid_number"],ready:function(){t.make_intarectable()},methods:{dispatch_add_row:function(e){this.$dispatch("event_add_row",e)}}}),Vue.component("lego_row",{template:"#row-template",props:["row_id","row_data","lego_layout","parent_type","parent_id","child_type","preview_data","type","grid_number"],methods:{dispatch_remove:function(e){this.$dispatch("remove_item",e)},dispatch_add_placeholder:function(e){this.$dispatch("event_add_placeholder",e)},dispatch_render_row_form:function(e){this.$dispatch("event_render_property_form",{id:e.id,type:e.type,property:JSON.parse(JSON.stringify(e.property))})}},ready:function(){t.make_intarectable()}}),Vue.component("lego_col",{template:"#col-template",props:["col_id","col_data","lego_layout","parent_type","parent_id","child_type","preview_data","type","grid_number"],data:function(){return{grid_array:[],show_grid_number_panel:!1,test_data:!0}},methods:{popup_widgetslist:function(e){o.show=!0,o.target_col=e},dispatch_remove:function(e){this.$dispatch("remove_item",e)},grid_enlarge:function(e){o.lego_layout.col[e.id].span<o.grid_number&&o.lego_layout.col[e.id].span++},grid_shorten:function(e){o.lego_layout.col[e.id].span>1&&o.lego_layout.col[e.id].span--},change_grid_width:function(e){this.show_grid_number_panel=!1,o.lego_layout[e.type][e.id].span=e.span},dispatch_render_col_form:function(e){this.$dispatch("event_render_property_form",e)},dispatch_add_section_in_placeholder:function(e){this.$dispatch("event_add_section_in_placeholder",e)}},ready:function(){for(t.make_intarectable(),i=1;i<=this.grid_number;i++)this.grid_array.push(i)}}),Vue.component("lego_element",{template:"#element-template",props:["elem_id","elem_data","lego_layout","parent_id","parent_type","child_type","preview_data","type"],computed:{widget_view:function(){}},methods:{dispatch_render_element_form:function(e,t,o,r,n,_){this.$dispatch("event_render_element_form",{elem_id:e,parent_type:this.parent_type,parent_id:this.parent_id,label:t,type:o,name:r,instance:n,id_base:_})},dispatch_remove:function(e){this.$dispatch("remove_item",e)},dispatch_preview_element:function(e){this.$dispatch("event_preview_element",e)}},ready:function(){t.make_intarectable()}});var t={init:function(){t.make_intarectable()},make_intarectable:function(){e(".lego-ground .container-fluid,.lego-ground .container").sortable({items:".row",connectWith:".lego-ground .container-fluid,.lego-ground .container",start:function(e,o){t.sort_start(e,o)},receive:function(e,o){t.sort_receive(e,o)},stop:function(e,o){t.sort_stop(e,o)}}),e(".lego-ground .row").sortable({items:".lego-placeholder",connectWith:".lego-ground .row",start:function(e,o){t.sort_start(e,o)},receive:function(e,o){t.sort_receive(e,o)},stop:function(e,o){t.sort_stop(e,o)}}),e(".lego-ground .lego-placeholder").sortable({items:".lego-elem",connectWith:".lego-ground .lego-placeholder",start:function(e,o){t.sort_start(e,o)},receive:function(e,o){t.sort_receive(e,o)},stop:function(e,o){t.sort_stop(e,o)}})},sort_start:function(t,r){o.sorting_obj.obj_id=e(r.item).attr("id"),o.sorting_obj.type=e(r.item).data("type"),o.sorting_obj.parent_type=e(r.item).data("parent_type"),o.sorting_obj.parent_id=e(r.item).data("parent_id"),o.sorting_obj.order=o.lego_layout[o.sorting_obj.parent_type][o.sorting_obj.parent_id].child[o.sorting_obj.type].indexOf(o.sorting_obj.obj_id)},sort_receive:function(t,r){o.sorting_obj.new_parent_id=e(t.target).attr("id"),o.sorting_obj.new_parent_type=e(t.target).data("type"),o.sorting_obj.new_order=e(r.item).index()-1},sort_stop:function(t,r){o.sorting_obj.new_parent_id?e(r.item).remove():(o.sorting_obj.new_parent_id=e(t.target).attr("id"),o.sorting_obj.new_parent_type=e(t.target).data("type"),o.sorting_obj.new_order=e(r.item).index()-1),o.lego_layout[o.sorting_obj.parent_type][o.sorting_obj.parent_id].child[o.sorting_obj.type].splice(o.sorting_obj.order,1),o.lego_layout[o.sorting_obj.new_parent_type][o.sorting_obj.new_parent_id].child[o.sorting_obj.type].splice(o.sorting_obj.new_order,0,o.sorting_obj.obj_id),o.reset_sorting_object()}},o=new Vue({el:"#wpwrap",data:{is_lego_enabled:is_lego_enabled,ground_data_id:"ground-"+(new Date).getTime(),grid_number:12,placeholder_padding:15,show_property_form:!1,show_section_layout:!1,show_custom_layout_input:!1,default_row_property:{attribute:{"class":""},style:{style:""}},default_col_property:{attribute:{"class":""},style:{style:""}},default_elem_property:{attribute:{"class":""},style:{style:""}},show:!1,lego_layout:lego_layout,target_cont:"",target_col:"",target_row:"",target_elem:{id:"",label:"",type:"",name:"",widgetized:"",property:""},show_widget_modal:!1,preview_data:{},preview_modal:!1,target_preview:"",sorting_obj:{obj_id:"",type:"",order:"",parent_type:"",parent_id:"",new_parent_id:"",new_parent_type:"",new_order:""},target_obj_property:{id:"",type:"",property:""}},computed:{lego_layout_min:function(){return JSON.stringify(this.lego_layout)}},methods:{insert_into_placeholder:function(){o.target_elem.instance=jQuery(".widget-body *").serialize();var e=o.target_elem.id;"-1"==o.lego_layout.col[o.target_col].child.element.indexOf(e)&&o.lego_layout.col[o.target_col].child.element.push(e),Vue.set(o.lego_layout.element,e,{label:o.target_elem.label,type:o.target_elem.type,name:o.target_elem.name,instance:o.target_elem.instance,id_base:o.target_elem.id_base,widgetized:o.target_elem.widgetized,property:o.target_elem.property}),o.target_col="",o.show_widget_modal=!1,o.show=!1,o.reset_target_elem()},reset_target_elem:function(){o.target_elem={label:"",type:"",name:"",instance:"",id_base:"",widgetized:"",property:""},o.target_obj_property=""},reset_all:function(){o.target_col="",o.target_row="",o.target_cont="",o.target_elem={label:"",type:"",name:"",instance:"",id_base:"",property:""}},reset_sorting_object:function(){o.sorting_obj={obj_id:"",type:"",order:"",parent_type:"",parent_id:"",new_parent_id:"",new_parent_type:"",new_order:""}},render_property_form:function(e){o.target_obj_property=e,o.show_property_form=!0},cancel_property_form:function(){o.reset_property_pointers(),o.show_property_form=!1},update_property:function(){o.lego_layout[o.target_obj_property.type][o.target_obj_property.id].property=o.target_obj_property.property,o.reset_property_pointers(),o.show_property_form=!1},reset_property_pointers:function(){o.target_obj_property={id:"",type:"",property:""}},render_element_form:function(e,t,r,n,_,a){var i="";if(o.target_elem.id){i=o.lego_layout.element[o.target_elem.id].property;var a=o.lego_layout.element[o.target_elem.id].widgetized}else o.target_elem.id="elem_"+(new Date).getTime();o.target_obj_property={id:o.target_elem.id,type:"element",property:""==i?o.default_elem_property:i},function(i){i.post(ajaxurl,{action:"wpsb_grab_element_data",type:t,name:r,id:o.target_elem.id,instance:n,id_base:_,nonce:wpsb_obj.ajaxnonce},function(n){o.target_elem.label=e,o.target_elem.type=t,o.target_elem.name=r,o.target_elem.id_base=_,o.target_elem.widgetized=a,o.target_elem.property=o.target_obj_property.property,i(".widget-label").html(e),i(".widget-body").html(n),o.show_widget_modal=!0})}(jQuery)},cancel_element_insert:function(){o.reset_target_elem(),o.show_widget_modal=!1},update_preview:function(e){!function(t){t.post(ajaxurl,{action:"wpsb_update_preview",id:e,type:"widget",lego_layout:o.lego_layout,nonce:wpsb_obj.ajaxnonce},function(t){Vue.set(o.preview_data,e,t),o.preview_element(e)})}(jQuery)},preview_element:function(e){o.target_preview=o.preview_data[e],o.preview_modal=!0},cancel_preview:function(){o.target_preview=!1,o.preview_modal=!1},add_section_in_placeholder:function(e){o.target_col=e.id,o.show_custom_layout_input=!0},add_row:function(e){if(!o.target_col&&!o.target_cont){var t=Object.keys(o.lego_layout.container);if(!t.length>0)return void alert("You must add a container to add row !");o.target_cont="undefined"==typeof e?t[t.length-1]:e}var r=o.generate_row_id();return o.target_cont?o.lego_layout.container[o.target_cont].child.row.push(r):o.lego_layout.col[o.target_col].child.row.push(r),Vue.set(o.lego_layout.row,r,{child:{col:[]},property:o.default_row_property}),o.reset_all(),r},add_placeholder:function(e,t,r){if(!o.target_row){var n=Object.keys(o.lego_layout.row);if(!n.length>0)return void alert("You must add a row to add palceholder !");o.target_row="undefined"==typeof e?n[n.length-1]:e}return"undefined"==typeof t&&(t=o.generate_col_id()),"undefined"==typeof r&&(r=o.grid_number),o.lego_layout.row[o.target_row].child.col.push(t),Vue.set(o.lego_layout.col,t,{child:{element:[],row:[]},span:r,property:o.default_col_property}),o.reset_all(),t},add_element:function(){if(!o.target_col){var e=Object.keys(o.lego_layout.col);if(!e.length>0)return void alert("You must add a placeholder to add palceholder !");o.target_col=e[e.length-1]}o.show=!0},generate_row_id:function(){return"row_"+(new Date).getTime()},generate_col_id:function(){return"col_"+(new Date).getTime()},generate_elem_id:function(){return"elem_"+(new Date).getTime()},generate_cont_id:function(){return"cont_"+(new Date).getTime()},enable_lego:function(){o.is_lego_enabled="true","object"!=typeof o.lego_layout&&(o.lego_layout={container:{},row:{},col:{},element:{}},Vue.set(o.lego_layout.container,o.generate_cont_id(),{child:{row:[]},is_fluid:""}))}},events:{event_render_element_form:function(e){o.target_col=e.parent_id,o.target_elem.id=e.elem_id,o.render_element_form(e.label,e.type,e.name,e.instance,e.id_base)},remove_item:function(t){var r=1;if(t.child_type)for(c in t.child_type)if(o.lego_layout[t.type][t.id].child[t.child_type[c]].length){r=0;break}return 0==r?void alert("Please ! Delete or move the inner items first !"):void(r&&(o.lego_layout[t.parent_type][t.parent_id].child[t.type].splice(o.lego_layout[t.parent_type][t.parent_id].child[t.type].indexOf(t.id),1),Vue.delete(o.lego_layout[t.type],t.id),e("#"+t.id).remove()))},event_add_placeholder:function(e){o.add_placeholder(e)},event_add_row:function(e){o.add_row(e)},event_render_property_form:function(e){o.render_property_form(e)},event_add_section_in_placeholder:function(e){o.add_section_in_placeholder(e)},event_preview_element:function(e){"undefined"==typeof o.preview_data[e]?o.update_preview(e):o.preview_element(e)},event_make_section:function(e){var t=o.add_row(),r=1,n=o.generate_col_id();for(span in e)n=o.add_placeholder(t,n,e[span]),n+=++r},event_bring_custom_layout:function(e){o.show_custom_layout_input=e}},ready:function(){"object"!=typeof this.lego_layout.row||Object.keys(this.lego_layout.row).length||(this.lego_layout.row={}),"object"!=typeof this.lego_layout.col||Object.keys(this.lego_layout.col).length||(this.lego_layout.col={}),"object"!=typeof this.lego_layout.element||Object.keys(this.lego_layout.element).length||(this.lego_layout.element={})}});t.init()}(jQuery),function(e){e(document).ready(function(){e(document).on("click","button",function(e){e.preventDefault()})})}(jQuery);